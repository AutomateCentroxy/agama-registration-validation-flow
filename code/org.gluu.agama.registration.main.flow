// User Registration Techniques
Flow org.gluu.agama.registration.main
     Basepath ""
     Timeout 700 seconds
     Configs conf
// Create  variable for UI feedback
uiFeedback = {}
// Iterate x times max
Repeat 6 times max
     // Retrieve user profile  from UI
     userInput = RRF "profile.ftlh" uiFeedback
     // create an instance of Registration service
     userRegistrationService = Call org.gluu.agama.user.UserRegistration#getInstance conf
     // Assign userName, email and password  to a variable
     email = userInput.mail
     userName = userInput.uid
     referralCode = userInput.referralCode
     country = userInput.country
     phone = userInput.phoneNumber
     // sent sms otp
     smsOtpSend = Call userRegistrationService sendOTPCode phone
     // The OTP Code has been send to user.
     Log "@info OTP generated and send to: " phone
     //  Show UI to collect OTP code from user.
     otpCreds = RRF "smsOtp.ftlh" uiFeedback
     //  Add log entry with collected code in log file.
     Log "@info Information provided by the user is : " otpCreds
     //  Validate the OTP code provided by the user.
     otpValidationResult = Call userRegistrationService validateOTPCode phone otpCreds.code
// Maximum attempt reached
Log "@info Maximum attempt reached"
// User Registration flow failed
it_aqxyn = {success:false, error: "User registration flow reached max attempts try later"}
Finish it_aqxyn