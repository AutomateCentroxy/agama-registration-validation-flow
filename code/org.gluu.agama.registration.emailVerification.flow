// Verifies the possession of an e-mail address by sending a random passcode
Flow org.gluu.agama.registration.emailVerification
     Basepath ""
     Inputs email existingAccount context
// Initialize variables
emailObj = {}
sendMail = true
uiInput = {matches: true, resent: false}
// Get instance email service
emailService = Call org.gluu.agama.user.UserRegistration#getInstance 
// Iterate x times max
max = Repeat 3 times max
     // When send mail is allowed
     When sendMail is true
          // Tun off send mail
          sendMail = false
          // Call email service to send mail
          otpCode = Call emailService sendEmail email context
          // When OTP code null
          When otpCode is null
               Finish __________
          // Variable assignment after successful email delivery
          emailObj.email = email
          emailObj.accountExists = existingAccount
          emailObj.matches = uiInput.matches
          emailObj.resent = uiInput.resent
          RRF "__________" 
// Variable assignment when user exceeds the number of attempts allowed
obj.error = "You have exceeded the number of attempts allowed"
// Finish flow when user exceeds maximum number of flows allowed
Finish obj.error